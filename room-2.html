<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Room - Firepit Fashion</title>

  <style>
    @font-face {
      font-family: 'NeuePixelSans';
      src: url('NeuePixelSans.ttf') format('truetype');
    }
    
    body {
      margin: 0;
      padding: 0;
      background: #074244;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    
    .wardrobe-scene {
      position: relative;
      width: 100vw;
      max-width: 1200px;
      aspect-ratio: 16/9;
    }
    
    .background {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      z-index: 1;
    }
    
    .character {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      z-index: 2;
    }
    
    .wardrobe-item {
      position: absolute;
      width: 10.5%; /* Main default size - 50% bigger */
      cursor: pointer;
      transition: transform 0.2s ease;
      z-index: 5;
    }
    
    .wardrobe-item:hover {
      transform: translateY(-10px);
    }
    
    .logo {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 200px;
      z-index: 10; /* Increased for clickability */
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    
    .logo:hover {
      transform: scale(1.05);
    }
    
    .save-button {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: #ff6b6b;
      color: white;
      border: none;
      padding: 15px 30px;
      font-family: 'NeuePixelSans', sans-serif;
      font-size: 18px;
      border-radius: 10px;
      cursor: pointer;
      z-index: 10;
      transition: transform 0.2s ease;
    }
    
    .save-button:hover {
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <script>
         function addOutfit(outfitType) {
       console.log('Adding outfit:', outfitType);
       const existingOutfit = document.querySelector(`.outfit-overlay[data-outfit="${outfitType}"]`);
       
       if (existingOutfit) {
         console.log('Removing outfit:', outfitType);
         existingOutfit.remove();
       } else {
         console.log('Adding outfit:', outfitType);
         
         const outfitOverlay = document.createElement('img');
         outfitOverlay.src = `boys-cartoon-clothes/${outfitType}.png`;
         outfitOverlay.className = 'outfit-overlay';
         outfitOverlay.setAttribute('data-outfit', outfitType);
         outfitOverlay.style.position = 'absolute';
         outfitOverlay.style.top = '50%';
         outfitOverlay.style.left = '50%';
         outfitOverlay.style.transform = 'translate(-50%, -50%)';
         outfitOverlay.style.maxWidth = '100%';
         outfitOverlay.style.maxHeight = '100%';
         outfitOverlay.style.width = 'auto';
         outfitOverlay.style.height = 'auto';
         outfitOverlay.style.objectFit = 'contain';
         outfitOverlay.style.zIndex = '3';
         document.body.appendChild(outfitOverlay);

         outfitOverlay.onerror = function() { console.error('Failed to load outfit image:', outfitType); };
         outfitOverlay.onload = function() { console.log('Outfit image loaded successfully:', outfitType); };
       }
     }

    function getUrlParameter(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

         window.addEventListener('load', function() {
       const character = getUrlParameter('character');
       const characterImg = document.getElementById('character');
       
       let characterSrc = 'ace.png'; // Default
       
       if (character) {
         switch(character) {
           case 'ace':
             characterSrc = 'ace.png';
             break;
           case 'nick':
             characterSrc = 'nick.png';
             break;
           case 'pepe':
             characterSrc = 'pepe.png';
             break;
           default:
             characterSrc = 'ace.png';
         }
       }
       
       characterImg.src = characterSrc;
     });

         async function saveCharacterSnapshot() {
       console.log('UPDATED SAVE FUNCTION - CACHE BUSTED!');
       alert('NEW VERSION LOADED - Testing cropped background!');
       
       try {
         // 1. Create fixed-size canvas (1080x1920 for story format)
         const canvas = document.createElement('canvas');
         canvas.width = 1080;
         canvas.height = 1920;
         const ctx = canvas.getContext('2d');
         
         console.log('Canvas created:', canvas.width, 'x', canvas.height);

         // 2. Helper to load an image
         function loadImage(src) {
           return new Promise((resolve, reject) => {
             const img = new Image();
             img.crossOrigin = "anonymous";
             img.onload = () => {
               console.log('Image loaded successfully:', src);
               resolve(img);
             };
             img.onerror = () => {
               console.error('Failed to load image:', src);
               reject(new Error(`Failed to load image: ${src}`));
             };
             img.src = src;
           });
         }

         console.log('Loading background...');
         // 3. Load and draw CROPPED background (left side only)
         const bg = await loadImage('room-2.png');
         
         // Crop to left 50% of original background
         const cropWidth = bg.width * 0.5;
         const cropHeight = bg.height;
         
         // Draw that cropped part stretched to full canvas
         ctx.drawImage(
           bg,
           0, 0, cropWidth, cropHeight, // source crop
           0, 0, canvas.width, canvas.height // fill canvas
         );
         console.log('Background drawn (cropped left side)');

         console.log('Loading logo...');
         // 4. Draw logo at top center
         const logo = await loadImage('logo.png');
         const logoWidth = 400;
         const logoHeight = (logo.height / logo.width) * logoWidth;
         const logoX = (canvas.width - logoWidth) / 2;
         ctx.drawImage(logo, logoX, 50, logoWidth, logoHeight);
         console.log('Logo drawn at:', logoX, 50);

         console.log('Loading character...');
         // 5. Draw character (scaled bigger + centered in new crop)
         const currentCharacterBase = document.getElementById('character').src;
         console.log('Character source:', currentCharacterBase);
         const character = await loadImage(currentCharacterBase);
         
         // Crop out transparent padding from character image
         // Find the actual character bounds by scanning for non-transparent pixels
         const tempCanvas = document.createElement('canvas');
         const tempCtx = tempCanvas.getContext('2d');
         tempCanvas.width = character.width;
         tempCanvas.height = character.height;
         tempCtx.drawImage(character, 0, 0);
         
         const imageData = tempCtx.getImageData(0, 0, character.width, character.height);
         const data = imageData.data;
         
         let minX = character.width, minY = character.height, maxX = 0, maxY = 0;
         
         // Scan for non-transparent pixels
         for (let y = 0; y < character.height; y++) {
           for (let x = 0; x < character.width; x++) {
             const index = (y * character.width + x) * 4;
             const alpha = data[index + 3];
             if (alpha > 10) { // Non-transparent pixel
               minX = Math.min(minX, x);
               minY = Math.min(minY, y);
               maxX = Math.max(maxX, x);
               maxY = Math.max(maxY, y);
             }
           }
         }
         
         // Calculate cropped dimensions
         const charCropWidth = maxX - minX + 1;
         const charCropHeight = maxY - minY + 1;
         
         console.log('Character bounds:', minX, minY, maxX, maxY);
         console.log('Cropped size:', charCropWidth, 'x', charCropHeight);
         
         // Make character fill 80% of canvas height
         const charHeight = canvas.height * 0.8;
         const charWidth = (charCropWidth / charCropHeight) * charHeight;
         
         // Center horizontally + position vertically in the middle
         const charX = (canvas.width - charWidth) / 2;
         const charY = (canvas.height - charHeight) / 2;
         
         // Draw the cropped character (without transparent padding)
         ctx.drawImage(
           character,
           minX, minY, charCropWidth, charCropHeight, // source crop
           charX, charY, charWidth, charHeight // destination
         );
         console.log('Character drawn at:', charX, charY, 'size:', charWidth, 'x', charHeight);
         console.log('Canvas dimensions:', canvas.width, 'x', canvas.height);
         console.log('Character should be centered at:', (canvas.width - charWidth) / 2, (canvas.height - charHeight) / 2);

         console.log('Loading outfits...');
         // 6. Draw outfits at same position/size as character
         const equippedItems = document.querySelectorAll('.outfit-overlay');
         console.log('Found', equippedItems.length, 'outfits');
         for (const item of equippedItems) {
           console.log('Loading outfit:', item.src);
           const clothing = await loadImage(item.src);
           
           // Crop outfit the same way as character
           const outfitTempCanvas = document.createElement('canvas');
           const outfitTempCtx = outfitTempCanvas.getContext('2d');
           outfitTempCanvas.width = clothing.width;
           outfitTempCanvas.height = clothing.height;
           outfitTempCtx.drawImage(clothing, 0, 0);
           
           const outfitImageData = outfitTempCtx.getImageData(0, 0, clothing.width, clothing.height);
           const outfitData = outfitImageData.data;
           
           let outfitMinX = clothing.width, outfitMinY = clothing.height, outfitMaxX = 0, outfitMaxY = 0;
           
           // Scan for non-transparent pixels
           for (let y = 0; y < clothing.height; y++) {
             for (let x = 0; x < clothing.width; x++) {
               const index = (y * clothing.width + x) * 4;
               const alpha = outfitData[index + 3];
               if (alpha > 10) { // Non-transparent pixel
                 outfitMinX = Math.min(outfitMinX, x);
                 outfitMinY = Math.min(outfitMinY, y);
                 outfitMaxX = Math.max(outfitMaxX, x);
                 outfitMaxY = Math.max(outfitMaxY, y);
               }
             }
           }
           
           const outfitCropWidth = outfitMaxX - outfitMinX + 1;
           const outfitCropHeight = outfitMaxY - outfitMinY + 1;
           
           // Draw the cropped outfit at same position as character
           ctx.drawImage(
             clothing,
             outfitMinX, outfitMinY, outfitCropWidth, outfitCropHeight, // source crop
             charX, charY, charWidth, charHeight // destination
           );
           console.log('Outfit drawn (cropped)');
         }

         console.log('Creating download link...');
         // 7. Download the final image
         const link = document.createElement('a');
         link.download = 'firepit-fashion-story.png';
         link.href = canvas.toDataURL('image/png');
         console.log('Downloading image...');
         
         // Debug: Let's see what the canvas contains
         console.log('Canvas data URL length:', link.href.length);
         console.log('Canvas data URL preview:', link.href.substring(0, 100) + '...');
         
         // Try to trigger download
         document.body.appendChild(link);
         link.click();
         document.body.removeChild(link);
         console.log('Download complete!');
         
         // Also show a preview in the console
         console.log('Canvas preview - check if this shows the correct image:');
         console.log('Canvas width:', canvas.width, 'height:', canvas.height);
         
       } catch (error) {
         console.error('Error saving image:', error);
         alert('Error saving image: ' + error.message);
       }
     }
  </script>
  

   <div class="wardrobe-scene">
     <img src="room-2.png" alt="Room Background" class="background">
    <!-- Row 1 (Top shelf â€“ hoodies, shirts, ascot) -->
    <img src="boys-wardrobe/pink-hoodie-asset.png" alt="Pink Hoodie" class="wardrobe-item" style="left: 45%; top: 15%; width: 11.55%;" onclick="addOutfit('pink-hoodie')">
    <img src="boys-wardrobe/green-shirt.png" alt="Green Shirt" class="wardrobe-item" style="left: 55%; top: 8%; width: 11.55%;" onclick="addOutfit('green-shirt')">
    <img src="boys-wardrobe/ascot-asset.png" alt="Ascot" class="wardrobe-item" style="left: 90%; top: 15%; width: 4.2%;" onclick="addOutfit('ascot')">
    
    <!-- Row 2 (Second shelf â€“ T-shirts & polos) -->
    <img src="boys-wardrobe/meatball-shirt-asset.png" alt="Meatball Shirt" class="wardrobe-item" style="left: 45%; top: 42%; width: 11.55%;" onclick="addOutfit('meatball-shirt')">
    <img src="boys-wardrobe/tank-asset.png" alt="Tank" class="wardrobe-item" style="left: 57%; top: 42%; width: 7.7%;" onclick="addOutfit('tank')">
    <img src="boys-wardrobe/linen-shirt-asset.png" alt="Linen Shirt" class="wardrobe-item" style="left: 66%; top: 42%; width: 11.55%;" onclick="addOutfit('linen-shirt')">
    <img src="boys-wardrobe/striped-shirt-asset.png" alt="Striped Shirt" class="wardrobe-item" style="left: 77%; top: 42%; width: 11.55%;" onclick="addOutfit('striped-shirt')">
    
    <!-- Row 3 (Third shelf â€“ shorts & pants) -->
    <img src="boys-wardrobe/camo-pants-asset.png" alt="Camo Pants" class="wardrobe-item" style="left: 45%; top: 64%;" onclick="addOutfit('camo-pants')">
    <img src="boys-wardrobe/navy-shorts-asset.png" alt="Navy Shorts" class="wardrobe-item" style="left: 55.5%; top: 64%;" onclick="addOutfit('navy-shorts')">
    <img src="boys-wardrobe/striped-shorts-asset.png" alt="Striped Shorts" class="wardrobe-item" style="left: 66%; top: 64%;" onclick="addOutfit('striped-shorts')">
    <img src="boys-wardrobe/pink-shorts-asset.png" alt="Pink Shorts" class="wardrobe-item" style="left: 77%; top: 64%;" onclick="addOutfit('pink-shorts')">
    <img src="boys-wardrobe/white-jeans-asset.png" alt="White Jeans" class="wardrobe-item" style="left: 88.5%; top: 64%; width: 7.7%;" onclick="addOutfit('white-jeans')">
    
    <!-- Row 4 (Bottom shelf â€“ shoes) -->
    <img src="boys-wardrobe/loafers-asset.png" alt="Loafers" class="wardrobe-item" style="left: 47%; top: 87%; width: 5%;" onclick="addOutfit('loafers')">
    <img src="boys-wardrobe/sandals-asset.png" alt="Sandals" class="wardrobe-item" style="left: 54%; top: 87%; width: 5%;" onclick="addOutfit('sandals')">
  </div>
  <img src="ace.png" alt="Character" class="character" id="character">
  <img src="logo.png" alt="Logo" class="logo" onclick="window.location.href='index.html'">
  <button class="save-button" onclick="saveCharacterSnapshot()">SAVE ðŸ“¸</button>
</body>
</html> 